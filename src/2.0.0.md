# Taffy

> Convention-over-Configuration REST framework for ColdFusion and Railo

<div class="links">
	<a href="https://github.com/atuttle/Taffy/archive/v2.0.0.zip">Taffy 2.0.0<strong>.zip</strong></a> &mdash;
	<a href="https://github.com/atuttle/Taffy/archive/v2.0.0.tar.gz">Taffy 2.0.0<strong>.tar.gz</strong></a> &mdash;
	<a href="https://github.com/atuttle/Taffy/releases/tag/v2.0.0">Release Notes</a> &mdash;
	<a href="https://github.com/atuttle/Taffy">GitHub</a>
</div>

## Quickstart: Your First API

**Application.cfc:**

	component extends="taffy.core.api" {}

**index.cfm:**

	<!-- this space left intentionally blank -->

**/resources/hello.cfc:**

	component extends="taffy.core.resource" taffy_uri="/hello" {

		function get(){
			return representationOf(['hello','world']);
		}

	}

Congratulations, you've just written your first API. Did you think it could be so simple?

Point your browser to the empty **index.cfm** file you created, and have a look at the dashboard. Click the "hello" row to expand it, and click the **Send** button to make a REST request. The results of your request are displayed below.

The response includes a **status code** and **status text**, as well as other **headers**, and the **response body** (if applicable). Taffy also shows you the amount of time the request took.

## More Guides

Some guides are too broad for this document. For your benefit, they are linked here:

* blah

## Reference

### Configuration via Metadata

### variables.framework

Default values:

	variables.framework = {
		reloadKey = "reload",
		reloadPassword = "true",
		reloadOnEveryRequest = false,

		endpointURLParam = "endpoint",

		representationClass = "taffy.core.nativeJsonRepresentation",

		dashboardKey = "dashboard",
		disableDashboard = false,
		disabledDashboardRedirect = "",

		jsonp = false,

		unhandledPaths = "/flex2gateway",
		allowCrossDomain = false,
		globalHeaders = structNew(),
		debugKey = "debug",

		useEtags = false,

		returnExceptionsAsJson = true,
		exceptionLogAdapter = "taffy.bonus.LogToEmail",
		exceptionLogAdapterConfig = {
			emailFrom = "api-error@yourdomain.com",
			emailTo = "you@yourdomain.com",
			emailSubj = "Exception Trapped in API",
			emailType = "html"
		},

		beanFactory = "",

		environments = {}
	};

#### reloadKey

**Available in:** Taffy 1.2+<br/>
**Type:** String<br/>
**Default:** "reload"<br/>
**Description:** Name of the url parameter that requests the framework to be reloaded. Used in combination with the reload password (see: reloadPassword), the framework will re-initialize itself. During re-initialization, all configuration settings are re-applied and all cached objects are cleared and reloaded. If the value of the key does not match the reload password, a reload will not be performed. This allows you to set a secret password to restrict control of reloading your API to trusted parties.

#### reloadPassword

**Available in:** Taffy 1.2+<br/>
**Type:** String<br/>
**Default:** "true"<br/>
**Description:** Accepted value of the url parameter that requests the framework to be reloaded. Used in combination with the reload key (see: reloadKey), the framework will re-initialize itself. During re-initialization, all configuration settings are re-applied and all cached objects are cleared and reloaded. If the value of the key does not match the reload password, a reload will not be performed. This allows you to set a secret password to restrict control of reloading your API to trusted parties.

#### reloadOnEveryRequest

**Available in:** Taffy 1.2+<br/>
**Type:** Boolean<br/>
**Default:** False<br/>
**Description:** Flag that indicates whether Taffy should reload cached values and configuration on every request. Useful in development; set to FALSE in production.

#### endpointURLParam

**Available in:** Taffy 1.3+<br/>
**Type:** String<br/>
**Default:** "endpoint"<br/>
**Description:** The query-string parameter name that can optionally be used to specify URI. Until now, URI formatting has been required to be index.cfm/URI; this parameter allows you to use index.cfm?endpoint=/URI. This setting (endpointURLParam) allows you to change the default parameter name of "endpoint" to something custom.

#### representationClass

**Available in:** Taffy 1.2+<br/>
**Type:** String<br/>
**Default:** "taffy.core.nativeJsonRepresentation"<br/>
**Description:** The CFC dot-notation path, or bean name, of the representation class that your API will use to serialize returned data for the client.

#### dashboardKey

**Available in:** Taffy 1.2+<br/>
**Deprecated **in: Taffy 1.3+<br/>
**Type:** String<br/>
**Default:** "dashboard"
Description: Name of the url parameter that displays the dashboard. The dashboard displays resources that your API is aware of, generates documentation about your API based on hint attributes, and contains a mock client to make testing your API easy.

#### disableDashboard

**Available in:** Taffy 1.2+<br/>
**Type:** Boolean<br/>
**Default:** False<br/>
**Description:** Whether or not Taffy will allow the dashboard to be displayed. If set to true, the dashboard key is simply ignored. You may wish to disable the dashboard in production, depending on whether or not you want customers/clients to be able to see it.

#### disabledDashboardRedirect

**Available in:** Taffy 1.3+<br/>
**Type:** String<br/>
**Default:** ""<br/>
**Description:** URL to which Taffy should redirect (302) the client/browser if the dashboard is disabled. If the dashboard is disabled and this value is blank, a simple 403 Forbidden response is sent instead.

#### jsonp

**Available in:** Taffy 2.0+<br/>
**Type:** Boolean/String<br/>
**Default:** false<br/>
**Description:** When false, JSONP is disabled. To enable it, change the value to a string, such as "callback". The value you specify will be the query parameter in which Taffy expects to find the JSONP callback name. Note: JSONP only works for GET requests (by design!)

#### unhandledPaths

**Available in:** Taffy 1.2+<br/>
**Type:** String (Comma-delimited list)<br/>
**Default:** "/flex2gateway"<br/>
**Description:** Set a list of paths (usually subfolders of the API) that you do not want Taffy to interfere with. Unless listed here, Taffy takes over the request lifecycle and does not execute the requested ColdFusion template.

#### allowCrossDomain

**Available in:** Taffy 1.2+<br/>
**Type:** Boolean<br/>
**Default:** False<br/>
**Description:** Whether or not to allow cross-domain access to your API. Turning this on adds the following headers:

	<cfheader name="Access-Control-Allow-Origin" value="*" />
	<cfheader name="Access-Control-Allow-Methods" value="#allowedVerbs#" />
	<cfheader name="Access-Control-Allow-Headers" value="Content-Type" />

The allowed verbs, of course, are the ones allowed by the requested resource, as well as OPTIONS.

#### globalHeaders

**Available in:** Taffy 1.2+<br/>
**Type:** Structure<br/>
**Default:** {}<br/>
**Description:** A structure where each key is the name of a header you want to return, such as "X-MY-HEADER" and the structure value is the header value.

Global headers are static. You set them on application initialization and they do not change. If you need dynamic headers, you can add them to each response at runtime using withHeaders().

#### debugKey

**Available in:** Taffy 1.2+<br/>
**Type:** String<br/>
**Default:** "debug"<br/>
**Description:** Name of the url parameter that enables CF Debug Output.

#### useEtags

**Available in:** Taffy 1.3+<br/>
**Type:** Boolean<br/>
**Default:** False<br/>
**Description:** Enable the use of HTTP ETags for caching purposes. Taffy will automatically handle both sending the server ETag value and detecting client supplied ETags (via the If-None-Match header) for you; simply turn this setting on.

**NOTE FOR RAILO USERS:** While it will not cause errors, the underlying Java code used in this feature was improperly implemented prior to Railo 4.0.? and this could result in your result data being sent as if it were changed when it in fact has not. (I'm not sure which Railo point release will include the fix. The latest as of this writing is version 4.0.2, and does not include it.) Adobe ColdFusion is unaffected.

#### returnExceptionsAsJson

**Available in:** Taffy 1.2+<br/>
**Type:** Boolean<br/>
**Default:** true<br/>
**Description:** When an error occurs that is not otherwise handled, this option tells Taffy to attempt to format the error information as JSON and return that (regardless of the requested return format).

#### exceptionLogAdapter

**Available in:** Taffy 1.2+<br/>
**Type:** String<br/>
**Default:** "taffy.bonus.LogToEmail"<br/>
**Description:** CFC dot-notation path to the exception logging adapter you want to use. Default adapter simply emails all exceptions. See Exception Logging Adapters for more details.

#### exceptionLogAdapterConfig

**Available in:** Taffy 1.2+<br/>
**Type:** Any<br/>
**Default:** See values at top of this page<br/>
**Description:** Configuration that your chosen logging adapter requires. Can be any data type. See Exception Logging Adapters for more details.

#### beanFactory

**Available in:** Taffy 1.2+<br/>
**Type:** Object Instance<br/>
**Default:** ""<br/>
**Description:** Already instantiated and cached (e.g. in Application scope) object instance of your external bean factory. Not required in order to use Taffy's built-in factory.

#### environments

**Available in:** Taffy 1.3+<br/>
**Type:** Structure<br/>
**Default:** {}<br/>
**Description:** Environment-specific overrides to any framework settings. Applied after general variables.framework settings, and after configureTaffy() has been called. See Environment Specific Configuration for more details.

### Application.cfc

### Resources

### Custom Representation Classes